# prompts_stage1.py
"""
STAGE1 상품명 정제용 프롬프트 & 문자열 유틸

- 사용하는 엑셀 컬럼:
  - 카테고리명
  - 판매형태  (예: 단품형 / 옵션형)
  - 원본상품명

- 다른 파일에서는 다음 함수들만 import 해서 사용하면 됨:
  - from prompts_stage1 import STAGE1_PROMPT_TEMPLATE, safe_str, build_stage1_prompt
"""

from typing import Any
import pandas as pd


# 신규 숏폼버전 251201
STAGE1_PROMPT_TEMPLATE = """
당신은 온라인 쇼핑몰 위탁판매용 상품명 정제 전문가입니다.
입력된 정보를 바탕으로 광고와 브랜드 거품을 제거하고, 검색에 강한 정보 중심 상품명 한 줄을 작성하십시오.
최종 출력 전에 아래 규칙을 모두 만족하는지 스스로 점검하되, 점검 과정이나 이유는 출력하지 마십시오.

[입력 정보]
- 카테고리명: {category}
- 판매형태: {sale_type}  (참고용 메타 정보이며, 결과 상품명에 그대로 쓰지 말 것)
- 원본 상품명: {raw_name}

[정제 규칙]

1. 구조 재배열 (우선순위)
- 권장 순서: [핵심 제품군] > [기능/사용상황] > [규격/수량] > [대상/스타일] > [시즌/테마] > [옵션/색상]
- 문장이 아닌 명사형 키워드 나열로 작성합니다.
- 전체 길이는 띄어쓰기 포함 최대 60자로 맞추고,
  초과 시 중요도가 낮은 수식어부터 제거하여 60자 이내로 줄입니다.

2. 노이즈 및 브랜드 제거
- 삭제 대상:
  · 광고·홍보 문구: 무료배송, 당일배송, 오늘출발, 특가, 행사, 인기, 추천,
    최저가, 빅세일, 주문폭주, 인싸템, 핫딜, MD추천, 한정수량, 국민템 등
  · 상점/몰/마켓명: ○○몰, ○○샵, ○○스토어, ○○마켓, 공식몰, 전문몰, 직영몰 등
  · 일반 브랜드명: 나이키, 아디다스 등 위탁판매자가 경쟁우위를 갖지 못하는 브랜드명
  · 이모티콘·과한 기호(♥, ★, !!, [], /, ·, , 등)
- 괄호는 꼭 필요한 규격/옵션 표기에만 최소한으로 사용하고,
  불필요한 괄호나 빈 괄호는 제거합니다.
- 유지 대상:
  피치기모, 쿠션폼, 수제, 핸드메이드, DIY, 호환용 등 재질·특성을 나타내는 단어는
  브랜드가 아니라 속성이므로 유지합니다.

3. 정보 정확성
- 원본에 없는 정보(재질, 기능, 용량, 인증, 브랜드 등)를 추측하여 만들지 않습니다.
- 숫자, 모델명, 사이즈, 용량 등은 원본에 나온 값만 사용하며,
  임의로 바꾸거나 새로 추가하지 않습니다.
- 한글/영문 표기는 원본을 존중하되,
  불필요한 반복이나 어색한 표기는 자연스럽게 정돈합니다.

4. 스타일 제약
- “~입니다”, “~해요”, “어떠세요?” 같은 문장형 표현을 사용하지 않습니다.
- “상품명:”, “정제된 상품명:” 같은 라벨이나 설명 문구를 붙이지 않습니다.
- 이모티콘, 과장된 느낌표, 의미 없는 기호는 모두 제거합니다.

[출력 형식]
위 규칙을 엄수하여, 정제된 상품명 텍스트 **한 줄만** 출력하십시오.
"""
# =====================================
# 유틸 함수
# =====================================

def safe_str(v: Any) -> str:
    """
    NaN / None 안전하게 문자열로 변환 + strip
    """
    if v is None:
        return ""
    try:
        if pd.isna(v):
            return ""
    except Exception:
        pass
    return str(v).strip()


def build_stage1_prompt(category: str, sale_type: str, raw_name: str) -> str:
    """
    엑셀에서 읽어온 카테고리명 / 판매형태 / 원본상품명으로
    최종 STAGE1 프롬프트 한 덩어리를 만들어 반환.
    """
    return STAGE1_PROMPT_TEMPLATE.format(
        category=safe_str(category) or "(카테고리 없음)",
        sale_type=safe_str(sale_type) or "(판매형태 미지정)",
        raw_name=safe_str(raw_name) or "(원본 상품명 없음)",
    )
