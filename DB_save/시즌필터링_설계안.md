# ì‹œì¦Œ í•„í„°ë§ ì‹œìŠ¤í…œ ì„¤ê³„ì•ˆ

## 1. ê°œìš”

í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì‹œì¦Œì´ ì§€ë‚œ ìƒí’ˆì„ ìë™ìœ¼ë¡œ í•„í„°ë§í•˜ì—¬ ë§ˆì¼“ ì—…ë¡œë“œ ì‹œ ë¶€ì ì ˆí•œ ìƒí’ˆì´ ì˜¬ë¼ê°€ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™**: ì‹œì¦Œ í•„í„°ë§ì€ **ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ì— ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ì „**ì— ìˆ˜í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

## 2. ë°ì´í„° êµ¬ì¡°

### 2.1 ì‹œì¦Œ ì„¤ì • íŒŒì¼ (JSON)

**íŒŒì¼ ìœ„ì¹˜**: `ìƒí’ˆê°€ê³µí”„ë¡œê·¸ë¨/DB_save/season_filters.json`

```json
{
  "version": "1.0",
  "seasons": [
    {
      "id": "halloween",
      "name": "í• ë¡œìœˆ",
      "keywords": ["í• ë¡œìœˆ", "Halloween", "í˜¸ë°•", "ìœ ë ¹", "ë§ˆë…€", "ì‚¬íƒ•"],
      "start_date": "10-01",  // MM-DD í˜•ì‹
      "end_date": "10-31",
      "description": "í• ë¡œìœˆ ê´€ë ¨ ìƒí’ˆ"
    },
    {
      "id": "christmas",
      "name": "í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
      "keywords": ["í¬ë¦¬ìŠ¤ë§ˆìŠ¤", "Christmas", "ì‚°íƒ€", "íŠ¸ë¦¬", "ì„ ë¬¼", "ì¥ì‹"],
      "start_date": "12-01",
      "end_date": "12-25",
      "description": "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ê´€ë ¨ ìƒí’ˆ"
    },
    {
      "id": "valentine",
      "name": "ë°œë Œíƒ€ì¸ë°ì´",
      "keywords": ["ë°œë Œíƒ€ì¸", "Valentine", "ì´ˆì½œë¦¿", "í•˜íŠ¸", "ì‚¬ë‘"],
      "start_date": "02-01",
      "end_date": "02-14",
      "description": "ë°œë Œíƒ€ì¸ë°ì´ ê´€ë ¨ ìƒí’ˆ"
    },
    {
      "id": "summer",
      "name": "ì—¬ë¦„",
      "keywords": ["ì—¬ë¦„", "Summer", "ìˆ˜ì˜ë³µ", "ì„ í¬ë¦¼", "ì—ì–´ì»¨", "ì‹œì›"],
      "start_date": "06-01",
      "end_date": "08-31",
      "description": "ì—¬ë¦„ ì‹œì¦Œ ìƒí’ˆ"
    },
    {
      "id": "winter",
      "name": "ê²¨ìš¸",
      "keywords": ["ê²¨ìš¸", "Winter", "ì½”íŠ¸", "ì¥ê°‘", "ëª©ë„ë¦¬", "ë‚œë°©"],
      "start_date": "12-01",
      "end_date": "02-28",
      "description": "ê²¨ìš¸ ì‹œì¦Œ ìƒí’ˆ (12ì›”~2ì›”)"
    }
  ],
  "settings": {
    "filter_mode": "exclude_expired",  // "exclude_expired" | "include_all"
    "grace_period_days": 7,  // ì‹œì¦Œ ì¢…ë£Œ í›„ Nì¼ê°„ì€ í—ˆìš© (ì„ íƒì‚¬í•­)
    "case_sensitive": false  // í‚¤ì›Œë“œ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—¬ë¶€
  }
}
```

### 2.2 ìƒí’ˆ í…Œì´ë¸”ì— ì‹œì¦Œ ì •ë³´ ì¶”ê°€ (ì„ íƒì‚¬í•­)

**ì˜µì…˜ 1**: ìƒí’ˆëª…/í‚¤ì›Œë“œì—ì„œ ìë™ ê°ì§€ (ê¶Œì¥)
- ë³„ë„ ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆí•„ìš”
- ìƒí’ˆëª…, ì¹´í…Œê³ ë¦¬ëª…, í‚¤ì›Œë“œ ë“±ì—ì„œ ì‹œì¦Œ í‚¤ì›Œë“œ ë§¤ì¹­

**ì˜µì…˜ 2**: ìƒí’ˆ í…Œì´ë¸”ì— `season_tags` ì»¬ëŸ¼ ì¶”ê°€
```sql
ALTER TABLE products ADD COLUMN season_tags TEXT;  -- JSON ë°°ì—´: ["halloween", "christmas"]
```

## 3. í•„í„°ë§ ë¡œì§

### 3.1 ì‹œì¦Œ ê°ì§€ ë¡œì§

```python
def detect_season_from_product(product: Dict, season_config: Dict) -> List[str]:
    """
    ìƒí’ˆ ì •ë³´ì—ì„œ ì‹œì¦Œ í‚¤ì›Œë“œë¥¼ ê°ì§€
    
    Args:
        product: ìƒí’ˆ ì •ë³´ ë”•ì…”ë„ˆë¦¬
        season_config: ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
    
    Returns:
        ê°ì§€ëœ ì‹œì¦Œ ID ë¦¬ìŠ¤íŠ¸ (ì˜ˆ: ["halloween", "christmas"])
    """
    detected_seasons = []
    
    # ê²€ìƒ‰ ëŒ€ìƒ í•„ë“œ
    search_fields = [
        product.get("ì›ë³¸ìƒí’ˆëª…", ""),
        product.get("ST1_ì •ì œìƒí’ˆëª…", ""),
        product.get("ST3_ê²°ê³¼ìƒí’ˆëª…", ""),
        product.get("ì¹´í…Œê³ ë¦¬ëª…", ""),
    ]
    
    # ëª¨ë“  í•„ë“œë¥¼ í•˜ë‚˜ì˜ í…ìŠ¤íŠ¸ë¡œ í•©ì¹¨
    search_text = " ".join(str(field) for field in search_fields if field)
    
    # ê° ì‹œì¦Œì˜ í‚¤ì›Œë“œì™€ ë§¤ì¹­
    for season in season_config.get("seasons", []):
        keywords = season.get("keywords", [])
        season_id = season.get("id", "")
        
        for keyword in keywords:
            if season_config.get("settings", {}).get("case_sensitive", False):
                if keyword in search_text:
                    detected_seasons.append(season_id)
                    break
            else:
                if keyword.lower() in search_text.lower():
                    detected_seasons.append(season_id)
                    break
    
    return list(set(detected_seasons))  # ì¤‘ë³µ ì œê±°
```

### 3.2 ì‹œì¦Œ ìœ íš¨ì„± ê²€ì‚¬

```python
from datetime import datetime

def is_season_valid(season_id: str, season_config: Dict, current_date: datetime = None) -> bool:
    """
    í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì‹œì¦Œì´ ìœ íš¨í•œì§€ í™•ì¸
    
    Args:
        season_id: ì‹œì¦Œ ID (ì˜ˆ: "halloween")
        season_config: ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
        current_date: í˜„ì¬ ë‚ ì§œ (ê¸°ë³¸ê°’: ì˜¤ëŠ˜)
    
    Returns:
        True: ì‹œì¦Œì´ ìœ íš¨í•¨ (í˜„ì¬ ì‹œì¦Œ ë‚´), False: ì‹œì¦Œì´ ì§€ë‚¨
    """
    if current_date is None:
        current_date = datetime.now()
    
    # ì‹œì¦Œ ì •ë³´ ì°¾ê¸°
    season = None
    for s in season_config.get("seasons", []):
        if s.get("id") == season_id:
            season = s
            break
    
    if not season:
        return True  # ì‹œì¦Œ ì •ë³´ê°€ ì—†ìœ¼ë©´ í†µê³¼
    
    # ë‚ ì§œ íŒŒì‹±
    start_date_str = season.get("start_date", "")  # "10-01"
    end_date_str = season.get("end_date", "")      # "10-31"
    
    if not start_date_str or not end_date_str:
        return True  # ë‚ ì§œ ì •ë³´ê°€ ì—†ìœ¼ë©´ í†µê³¼
    
    # í˜„ì¬ ì—°ë„ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ìƒì„±
    current_year = current_date.year
    start_month, start_day = map(int, start_date_str.split("-"))
    end_month, end_day = map(int, end_date_str.split("-"))
    
    start_date = datetime(current_year, start_month, start_day)
    end_date = datetime(current_year, end_month, end_day)
    
    # ì—°ë„ê°€ ë„˜ì–´ê°€ëŠ” ê²½ìš° ì²˜ë¦¬ (ì˜ˆ: 12-01 ~ 02-28)
    if end_date < start_date:
        # ë‹¤ìŒ í•´ë¡œ í™•ì¥
        if current_date.month >= start_month:
            # ì˜¬í•´ ì‹œì‘ì¼ ~ ë‚´ë…„ ì¢…ë£Œì¼
            end_date = datetime(current_year + 1, end_month, end_day)
        else:
            # ì‘ë…„ ì‹œì‘ì¼ ~ ì˜¬í•´ ì¢…ë£Œì¼
            start_date = datetime(current_year - 1, start_month, start_day)
    
    # Grace period ì ìš© (ì„ íƒì‚¬í•­)
    settings = season_config.get("settings", {})
    grace_period = settings.get("grace_period_days", 0)
    if grace_period > 0:
        from datetime import timedelta
        end_date = end_date + timedelta(days=grace_period)
    
    # í˜„ì¬ ë‚ ì§œê°€ ì‹œì¦Œ ê¸°ê°„ ë‚´ì¸ì§€ í™•ì¸
    return start_date <= current_date <= end_date
```

### 3.3 í•„í„°ë§ ì ìš©

```python
def filter_products_by_season(products: List[Dict], season_config: Dict, 
                              current_date: datetime = None) -> List[Dict]:
    """
    ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‹œì¦Œì´ ì§€ë‚œ ìƒí’ˆì„ í•„í„°ë§
    
    Args:
        products: ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
        season_config: ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
        current_date: í˜„ì¬ ë‚ ì§œ (ê¸°ë³¸ê°’: ì˜¤ëŠ˜)
    
    Returns:
        í•„í„°ë§ëœ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ (ì‹œì¦Œì´ ìœ íš¨í•œ ìƒí’ˆë§Œ)
    """
    if current_date is None:
        current_date = datetime.now()
    
    filtered_products = []
    excluded_count = 0
    excluded_seasons = {}
    
    for product in products:
        # ìƒí’ˆì—ì„œ ì‹œì¦Œ ê°ì§€
        detected_seasons = detect_season_from_product(product, season_config)
        
        if not detected_seasons:
            # ì‹œì¦Œ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ í†µê³¼ (ì¼ë°˜ ìƒí’ˆ)
            filtered_products.append(product)
            continue
        
        # ê°ì§€ëœ ì‹œì¦Œ ì¤‘ í•˜ë‚˜ë¼ë„ ìœ íš¨í•˜ë©´ í†µê³¼
        has_valid_season = False
        for season_id in detected_seasons:
            if is_season_valid(season_id, season_config, current_date):
                has_valid_season = True
                break
        
        if has_valid_season:
            filtered_products.append(product)
        else:
            # ëª¨ë“  ì‹œì¦Œì´ ì§€ë‚¬ìœ¼ë©´ ì œì™¸
            excluded_count += 1
            for season_id in detected_seasons:
                excluded_seasons[season_id] = excluded_seasons.get(season_id, 0) + 1
    
    return filtered_products, excluded_count, excluded_seasons
```

## 4. í†µí•© ìœ„ì¹˜

### 4.1 `db_handler.py`ì— ë©”ì„œë“œ ì¶”ê°€

```python
def get_products_for_upload(self, category: str, sheet_name: str, 
                            business_number: str, status: str = 'ACTIVE',
                            apply_season_filter: bool = True) -> List[Dict]:
    """
    ì—…ë¡œë“œìš© ìƒí’ˆ ì¡°íšŒ (ì‹œì¦Œ í•„í„°ë§ í¬í•¨)
    
    Args:
        category: ì¹´í…Œê³ ë¦¬ëª…
        sheet_name: ì‹œíŠ¸ëª… (ë§ˆì¼“ íƒ€ì…)
        business_number: ì‚¬ì—…ìë²ˆí˜¸
        status: ìƒí’ˆ ìƒíƒœ
        apply_season_filter: ì‹œì¦Œ í•„í„°ë§ ì ìš© ì—¬ë¶€
    
    Returns:
        í•„í„°ë§ëœ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
    """
    # 1. ê¸°ë³¸ ìƒí’ˆ ì¡°íšŒ (ê¸°ì¡´ ë¡œì§)
    products = self._get_products_base(category, status)
    
    # 2. ì‹œì¦Œ í•„í„°ë§ ì ìš© (ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ ì „ì— ìˆ˜í–‰)
    if apply_season_filter:
        season_config = self._load_season_config()
        if season_config:
            products, excluded_count, excluded_seasons = filter_products_by_season(
                products, season_config
            )
            # ë¡œê·¸ ê¸°ë¡ (ì„ íƒì‚¬í•­)
            if excluded_count > 0:
                print(f"[ì‹œì¦Œ í•„í„°] {excluded_count}ê°œ ìƒí’ˆ ì œì™¸ë¨: {excluded_seasons}")
    
    # 3. ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ (ê¸°ì¡´ ë¡œì§)
    # ... (upload_logs í…Œì´ë¸”ì—ì„œ ì´ë¯¸ ì‚¬ìš©í•œ ì¡°í•© ì œì™¸)
    
    return products
```

### 4.2 `main_window.py`ì— UI ì¶”ê°€

```python
# ì‹œì¦Œ í•„í„°ë§ ì„¤ì • í”„ë ˆì„ ì¶”ê°€
frame_season = ttk.LabelFrame(main_frame, text="ğŸ—“ï¸ ì‹œì¦Œ í•„í„°ë§", padding=10)
frame_season.pack(fill='x', pady=(0, 10))

# ì‹œì¦Œ í•„í„°ë§ í™œì„±í™” ì²´í¬ë°•ìŠ¤
self.season_filter_enabled = tk.BooleanVar(value=True)
ttk.Checkbutton(
    frame_season, 
    text="ì‹œì¦Œ í•„í„°ë§ í™œì„±í™” (í˜„ì¬ ì‹œì¦Œì´ ì§€ë‚œ ìƒí’ˆ ìë™ ì œì™¸)",
    variable=self.season_filter_enabled
).pack(side='left', padx=5)

# ì‹œì¦Œ ì„¤ì • ê´€ë¦¬ ë²„íŠ¼
btn_season_config = ttk.Button(
    frame_season, 
    text="âš™ï¸ ì‹œì¦Œ ì„¤ì • ê´€ë¦¬",
    command=self._open_season_config_window
)
btn_season_config.pack(side='right', padx=5)
```

## 5. ì‹œì¦Œ ì„¤ì • ê´€ë¦¬ GUI

### 5.1 ì‹œì¦Œ ì„¤ì • ì°½

```python
def _open_season_config_window(self):
    """ì‹œì¦Œ ì„¤ì • ê´€ë¦¬ ì°½ ì—´ê¸°"""
    config_window = tk.Toplevel(self)
    config_window.title("ì‹œì¦Œ í•„í„°ë§ ì„¤ì •")
    config_window.geometry("800x600")
    
    # ì‹œì¦Œ ëª©ë¡ í‘œì‹œ (íŠ¸ë¦¬ë·°)
    # ì‹œì¦Œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼
    # í‚¤ì›Œë“œ í¸ì§‘ ê¸°ëŠ¥
    # ë‚ ì§œ ë²”ìœ„ ì„¤ì •
```

## 6. ì¶”í›„ í™œìš©: ì†Œì‹± ëª©ë¡ ì¶”ì¶œ

### 6.1 ì‹œì¦Œë³„ ì†Œì‹± ëª©ë¡ ì¶”ì¶œ ê¸°ëŠ¥

```python
def get_sourcing_list_by_season(season_id: str, season_config: Dict) -> List[Dict]:
    """
    íŠ¹ì • ì‹œì¦Œ ìƒí’ˆ ì†Œì‹± ëª©ë¡ ì¶”ì¶œ
    
    Args:
        season_id: ì‹œì¦Œ ID (ì˜ˆ: "halloween")
        season_config: ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
    
    Returns:
        í•´ë‹¹ ì‹œì¦Œ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
    """
    # 1. ëª¨ë“  ìƒí’ˆ ì¡°íšŒ
    all_products = db_handler.get_all_products()
    
    # 2. ì‹œì¦Œ í‚¤ì›Œë“œë¡œ í•„í„°ë§
    season_products = []
    for product in all_products:
        detected_seasons = detect_season_from_product(product, season_config)
        if season_id in detected_seasons:
            season_products.append(product)
    
    return season_products
```

## 7. êµ¬í˜„ ìš°ì„ ìˆœìœ„

1. **1ë‹¨ê³„**: ì‹œì¦Œ ì„¤ì • íŒŒì¼ êµ¬ì¡° ë° ê¸°ë³¸ í•„í„°ë§ ë¡œì§ êµ¬í˜„
2. **2ë‹¨ê³„**: `get_products_for_upload()`ì— ì‹œì¦Œ í•„í„°ë§ í†µí•©
3. **3ë‹¨ê³„**: UIì— ì‹œì¦Œ í•„í„°ë§ ì˜µì…˜ ì¶”ê°€
4. **4ë‹¨ê³„**: ì‹œì¦Œ ì„¤ì • ê´€ë¦¬ GUI êµ¬í˜„
5. **5ë‹¨ê³„**: ì†Œì‹± ëª©ë¡ ì¶”ì¶œ ê¸°ëŠ¥ ì¶”ê°€

## 8. ì£¼ì˜ì‚¬í•­

- ì‹œì¦Œ í•„í„°ë§ì€ **ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ ì „**ì— ìˆ˜í–‰ë˜ì–´ì•¼ í•¨
- ì‹œì¦Œ í‚¤ì›Œë“œê°€ ì—†ëŠ” ìƒí’ˆì€ í•­ìƒ í†µê³¼ (ì¼ë°˜ ìƒí’ˆ)
- Grace period ì„¤ì •ìœ¼ë¡œ ì‹œì¦Œ ì¢…ë£Œ í›„ ì¼ì • ê¸°ê°„ í—ˆìš© ê°€ëŠ¥
- ì‹œì¦Œ ì„¤ì • íŒŒì¼ì€ JSON í˜•ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ ì‰½ê²Œ ìˆ˜ì • ê°€ëŠ¥

