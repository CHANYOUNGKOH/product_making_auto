# ì‹œì¦Œ í•„í„°ë§ ê°œì„ ì•ˆ ê²€í†  ë³´ê³ ì„œ

## ğŸ“‹ ì œì•ˆëœ ì•„ì´ë””ì–´ ìš”ì•½

### í•µì‹¬ ê°œì„ ì‚¬í•­
1. **Excel + JSON ì´ì¤‘ êµ¬ì¡°**: Excel í¸ì§‘ â†’ JSON ì»´íŒŒì¼
2. **ì ìˆ˜ì œ ì‹œì¦Œ ê°ì§€**: include/exclude í‚¤ì›Œë“œë¡œ ì •í™•ë„ í–¥ìƒ
3. **PREP ê¸°ê°„ ì¶”ê°€**: ì†Œì‹±/ê°€ê³µ ê¸°ê°„ì„ ê³ ë ¤í•œ 4ë‹¨ê³„ ì‹œìŠ¤í…œ
4. **íƒ€ì…ë³„ ì„¤ì •**: ì‹œì¦Œ íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ prep/grace/score_min ì„¤ì •
5. **ì‚­ì œ í›„ë³´ ê¸°ëŠ¥**: ì´ë¯¸ ì—…ë¡œë“œëœ ë§Œë£Œ ìƒí’ˆ ì°¾ê¸°

---

## âœ… ì¥ì  ë° ê°œì„ ì 

### 1. Excel + JSON ì´ì¤‘ êµ¬ì¡° â­â­â­â­â­

**ì¥ì :**
- âœ… **ì‚¬ìš©ì ì¹œí™”ì„±**: Excelë¡œ ì§ê´€ì ì¸ í¸ì§‘ ê°€ëŠ¥
- âœ… **ë“œë¡­ë‹¤ìš´/ìë™ì ê²€**: ë°ì´í„° ê²€ì¦ ìš©ì´
- âœ… **ì„±ëŠ¥**: ëŸ°íƒ€ì„ì—ëŠ” JSONë§Œ ì½ì–´ì„œ ë¹ ë¦„
- âœ… **ë²„ì „ ê´€ë¦¬**: Excelì€ í¸ì§‘ìš©, JSONì€ ì‹¤í–‰ìš©ìœ¼ë¡œ ì—­í•  ë¶„ë¦¬
- âœ… **ìë™ ìºì‹œ ê°±ì‹ **: "ì„¤ì • ì €ì¥" ë²„íŠ¼ ì—†ì´ë„ ìë™ ë°˜ì˜

**êµ¬í˜„ ì˜ˆì‹œ:**
```
Season_TYPE_Keyword.xlsx (í¸ì§‘ìš©)
â”œâ”€â”€ TYPE_PRESETS ì‹œíŠ¸: íƒ€ì…ë³„ ê¸°ë³¸ ì„¤ì •
â”œâ”€â”€ SEASON_MASTER ì‹œíŠ¸: ì‹œì¦Œ ê¸°ë³¸ ì •ë³´
â””â”€â”€ KEYWORDS ì‹œíŠ¸: ì‹œì¦Œë³„ í‚¤ì›Œë“œ (include/exclude)

â†“ ìë™ ì»´íŒŒì¼ (í”„ë¡œê·¸ë¨ ì‹œì‘ ì‹œ)

season_filters.json (ì‹¤í–‰ìš© ìºì‹œ)
â””â”€â”€ ë³‘í•©ëœ êµ¬ì¡° (types, seasons, keywords í†µí•©)
```

#### ğŸ”„ ìë™ ìºì‹œ ê°±ì‹  ë¡œì§ (ì¶”ê°€ ì œì•ˆ)

**í•µì‹¬ ì•„ì´ë””ì–´:**
- í”„ë¡œê·¸ë¨ ì‹œì‘ ì‹œ Excelê³¼ JSONì˜ ìˆ˜ì • ì‹œê°„(mtime) ë¹„êµ
- Excelì´ ë” ìµœì‹ ì´ë©´ ìë™ìœ¼ë¡œ JSON ì¬ìƒì„±
- "ì„¤ì • ì €ì¥" ë²„íŠ¼ ì—†ì´ë„ ìë™ ë°˜ì˜

**ë™ì‘ íë¦„:**
```
1. í”„ë¡œê·¸ë¨ ì‹œì‘
   â†“
2. season_filters.json ì¡´ì¬ í™•ì¸
   â†“
3. Excel ìˆ˜ì • ì‹œê°„ vs JSON ìˆ˜ì • ì‹œê°„ ë¹„êµ
   â†“
4-A. JSONì´ ìµœì‹ ì´ë©´ â†’ JSON ë¡œë”© (ë¹ ë¦„)
4-B. Excelì´ ë” ìµœì‹ ì´ë©´ â†’ Excel ì½ê¸° â†’ JSON ì¬ìƒì„± â†’ ë¡œë”©
   â†“
5. í•„í„° ë¡œì§ ìˆ˜í–‰
```

**êµ¬í˜„ ì˜ˆì‹œ:**
```python
import os
import json
from datetime import datetime
import pandas as pd

def load_season_config(excel_path: str, json_path: str) -> Dict:
    """
    ì‹œì¦Œ ì„¤ì • ë¡œë”© (ìë™ ìºì‹œ ê°±ì‹ )
    
    Args:
        excel_path: Excel íŒŒì¼ ê²½ë¡œ
        json_path: JSON ìºì‹œ íŒŒì¼ ê²½ë¡œ
    
    Returns:
        ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
    """
    # 1. Excel íŒŒì¼ ì¡´ì¬ í™•ì¸
    if not os.path.exists(excel_path):
        # Excelì´ ì—†ìœ¼ë©´ JSONë§Œ ì‚¬ìš© (ë˜ëŠ” ì—ëŸ¬ ì²˜ë¦¬)
        if os.path.exists(json_path):
            with open(json_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        raise FileNotFoundError(f"Excel íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {excel_path}")
    
    # 2. JSON ìºì‹œ ì¡´ì¬ ë° ìµœì‹ ì„± í™•ì¸
    excel_mtime = os.path.getmtime(excel_path)
    json_exists = os.path.exists(json_path)
    
    if json_exists:
        json_mtime = os.path.getmtime(json_path)
        # JSONì´ ìµœì‹ ì´ë©´ ë°”ë¡œ ë¡œë”©
        if json_mtime >= excel_mtime:
            try:
                with open(json_path, 'r', encoding='utf-8') as f:
                    config = json.load(f)
                print(f"[ì‹œì¦Œ í•„í„°] JSON ìºì‹œ ì‚¬ìš© (ìµœì‹ )")
                return config
            except Exception as e:
                print(f"[ì‹œì¦Œ í•„í„°] JSON ë¡œë”© ì‹¤íŒ¨: {e}, Excelì—ì„œ ì¬ìƒì„±")
                # JSON ë¡œë”© ì‹¤íŒ¨ ì‹œ Excelì—ì„œ ì¬ìƒì„±
    
    # 3. Excelì´ ë” ìµœì‹ ì´ê±°ë‚˜ JSONì´ ì—†ìœ¼ë©´ ì¬ìƒì„±
    print(f"[ì‹œì¦Œ í•„í„°] Excel ë³€ê²½ ê°ì§€ â†’ JSON ì¬ìƒì„±")
    try:
        # Excel ì½ê¸°
        config = parse_excel_to_config(excel_path)
        
        # JSON ì €ì¥
        with open(json_path, 'w', encoding='utf-8') as f:
            json.dump(config, f, ensure_ascii=False, indent=2)
        
        print(f"[ì‹œì¦Œ í•„í„°] JSON ìºì‹œ ìƒì„± ì™„ë£Œ")
        return config
        
    except Exception as e:
        # Excel íŒŒì‹± ì‹¤íŒ¨ ì‹œ
        if json_exists:
            # ì´ì „ JSON ìºì‹œê°€ ìˆìœ¼ë©´ ê²½ê³  í›„ ì‚¬ìš©
            print(f"[ì‹œì¦Œ í•„í„°] âš ï¸ Excel íŒŒì‹± ì‹¤íŒ¨: {e}")
            print(f"[ì‹œì¦Œ í•„í„°] ì´ì „ JSON ìºì‹œ ì‚¬ìš© (ë§ˆì§€ë§‰ ì •ìƒ ì„¤ì •)")
            with open(json_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        else:
            # JSONë„ ì—†ìœ¼ë©´ ì—ëŸ¬
            raise Exception(f"Excel íŒŒì‹± ì‹¤íŒ¨ ë° JSON ìºì‹œ ì—†ìŒ: {e}")

def parse_excel_to_config(excel_path: str) -> Dict:
    """
    Excel íŒŒì¼ì„ ì½ì–´ì„œ JSON êµ¬ì¡°ë¡œ ë³€í™˜
    
    Args:
        excel_path: Excel íŒŒì¼ ê²½ë¡œ
    
    Returns:
        ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
    """
    # Excel ì‹œíŠ¸ ì½ê¸°
    df_types = pd.read_excel(excel_path, sheet_name='TYPE_PRESETS')
    df_seasons = pd.read_excel(excel_path, sheet_name='SEASON_MASTER')
    df_keywords = pd.read_excel(excel_path, sheet_name='KEYWORDS')
    
    # JSON êµ¬ì¡°ë¡œ ë³€í™˜
    config = {
        "version": "2.0",
        "settings": {
            "filter_mode": "exclude_expired",
            "case_sensitive": False
        },
        "types": {},
        "seasons": []
    }
    
    # TYPE_PRESETS ì²˜ë¦¬
    for _, row in df_types.iterrows():
        type_id = row['íƒ€ì…ID']
        config["types"][type_id] = {
            "prep_days": int(row['prep_days']),
            "grace_days": int(row['grace_days']),
            "score_min": int(row.get('score_min', 1))
        }
    
    # SEASON_MASTER ì²˜ë¦¬
    for _, row in df_seasons.iterrows():
        season_id = row['ì‹œì¦ŒID']
        type_id = row['íƒ€ì…ID']
        
        # íƒ€ì… ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°
        type_defaults = config["types"].get(type_id, {})
        
        season = {
            "id": season_id,
            "name": row['ì‹œì¦Œëª…'],
            "type": type_id,
            "start_date": row['ì‹œì‘ì¼'],
            "end_date": row['ì¢…ë£Œì¼'],
            "cross_year": bool(row.get('cross_year', False)),
            "prep_days": int(row.get('prep_override', type_defaults.get('prep_days', 30))),
            "grace_days": int(row.get('grace_override', type_defaults.get('grace_days', 7))),
            "priority": int(row.get('priority', 1)),
            "keywords": {
                "include": [],
                "exclude": []
            }
        }
        
        # KEYWORDS ì²˜ë¦¬
        season_keywords = df_keywords[df_keywords['ì‹œì¦ŒID'] == season_id]
        for _, kw_row in season_keywords.iterrows():
            keyword = kw_row['í‚¤ì›Œë“œ']
            polarity = kw_row['polarity']  # "include" or "exclude"
            weight = float(kw_row.get('ê°€ì¤‘ì¹˜', 1.0))
            
            season["keywords"][polarity].append({
                "keyword": keyword,
                "weight": weight
            })
        
        config["seasons"].append(season)
    
    return config
```

**ì¥ì :**
- âœ… **ìš´ì˜ ë‚œì´ë„ ìµœì†Œ**: "ì„¤ì • ì €ì¥" ë²„íŠ¼ ë¶ˆí•„ìš”
- âœ… **ì„±ëŠ¥**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° JSONë§Œ ì½ì–´ì„œ ë¹ ë¦„
- âœ… **ì•ˆì •ì„±**: Excelì´ ì ê²¨ìˆì–´ë„ ì´ì „ JSON ì‚¬ìš© ê°€ëŠ¥
- âœ… **ì¬í˜„ì„±**: íŠ¹ì • ì‹œì ì˜ ì„¤ì •ì´ JSONìœ¼ë¡œ ë‚¨ì•„ ì¶”ì  ìš©ì´

**ì£¼ì˜ì‚¬í•­:**
- âš ï¸ Excel íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì •ì±… ê²°ì • í•„ìš” (ì´ì „ ìºì‹œ ì‚¬ìš© vs ê°•ì œ ì¤‘ë‹¨)
- âš ï¸ Excel íŒŒì¼ì´ ì—´ë ¤ìˆìœ¼ë©´ ìˆ˜ì • ì‹œê°„ì´ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

**ê¶Œì¥ì‚¬í•­:** âœ… **ì±„íƒ ê°•ë ¥ ê¶Œì¥** (ìš´ì˜ í¸ì˜ì„± ê·¹ëŒ€í™”)

---

### 2. ì ìˆ˜ì œ ì‹œì¦Œ ê°ì§€ â­â­â­â­

**ì¥ì :**
- âœ… **ì •í™•ë„ í–¥ìƒ**: include í‚¤ì›Œë“œ ë§¤ì¹­ ì‹œ ì ìˆ˜ ì¦ê°€
- âœ… **ì˜¤íƒ ë°©ì§€**: exclude í‚¤ì›Œë“œë¡œ í•˜ë“œ ì°¨ë‹¨
- âœ… **ìœ ì—°ì„±**: score_minìœ¼ë¡œ ì„ê³„ê°’ ì¡°ì ˆ ê°€ëŠ¥

**ì˜ˆì‹œ:**
```python
# ìƒí’ˆ: "í• ë¡œìœˆ í˜¸ë°• ì¥ì‹í’ˆ (ì¼ë°˜ìš©)"
# include: ["í• ë¡œìœˆ", "í˜¸ë°•"] â†’ +2ì 
# exclude: [] â†’ ì°¨ë‹¨ ì—†ìŒ
# score = 2, score_min = 1 â†’ í†µê³¼ âœ…

# ìƒí’ˆ: "ì¼ë°˜ í˜¸ë°• (í• ë¡œìœˆ ì•„ë‹˜)"
# include: ["í˜¸ë°•"] â†’ +1ì 
# exclude: ["í• ë¡œìœˆ"] â†’ í•˜ë“œ ì°¨ë‹¨
# score = 0 â†’ ì œì™¸ âŒ
```

**ì£¼ì˜ì‚¬í•­:**
- âš ï¸ **ì ìˆ˜ ê°€ì¤‘ì¹˜ ì„¤ì •**: ëª¨ë“  í‚¤ì›Œë“œê°€ ë™ì¼ ê°€ì¤‘ì¹˜ì¸ì§€, ì¤‘ìš” í‚¤ì›Œë“œëŠ” ê°€ì¤‘ì¹˜ ë†’ì¼ì§€ ê²°ì • í•„ìš”
- âš ï¸ **score_min ì„¤ì •**: ë„ˆë¬´ ë†’ìœ¼ë©´ ì¼ë°˜ ìƒí’ˆë„ ì œì™¸ë  ìˆ˜ ìˆìŒ

**ê¶Œì¥ì‚¬í•­:** âœ… **ì±„íƒ ê¶Œì¥** (ë‹¨, ì´ˆê¸°ì—ëŠ” ë‹¨ìˆœí™” ê°€ëŠ¥)

---

### 3. PREP ê¸°ê°„ ì¶”ê°€ â­â­â­â­â­

**ì¥ì :**
- âœ… **ì‹¤ë¬´ ë°˜ì˜**: ì†Œì‹±/ê°€ê³µ ê¸°ê°„ì„ ê³ ë ¤í•œ í˜„ì‹¤ì ì¸ í•„í„°ë§
- âœ… **4ë‹¨ê³„ ì‹œìŠ¤í…œ**: PREP â†’ ACTIVE â†’ GRACE â†’ EXPIRE
- âœ… **ìœ ì—°ì„±**: íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ prep_days ì„¤ì • ê°€ëŠ¥

**4ë‹¨ê³„ ì‹œìŠ¤í…œ:**
```
PREP: start_date - prep_days ~ start_date-1
  â†’ ì†Œì‹±/ê°€ê³µ ê¸°ê°„ (ì—…ë¡œë“œëŠ” ì•ˆ ë˜ì§€ë§Œ ì†Œì‹±ì€ ê°€ëŠ¥)

ACTIVE: start_date ~ end_date
  â†’ ì •ìƒ ì—…ë¡œë“œ ê°€ëŠ¥

GRACE: end_date+1 ~ end_date + grace_days
  â†’ ì‹œì¦Œ ì¢…ë£Œ í›„ ì¼ì • ê¸°ê°„ í—ˆìš©

EXPIRE: ê·¸ ì´í›„
  â†’ ì™„ì „íˆ ì œì™¸
```

**ì˜ˆì‹œ:**
```
í• ë¡œìœˆ ì‹œì¦Œ (10-01 ~ 10-31)
- prep_days: 30ì¼
- PREP: 09-01 ~ 09-30 (ì†Œì‹± ê°€ëŠ¥, ì—…ë¡œë“œ ë¶ˆê°€)
- ACTIVE: 10-01 ~ 10-31 (ì—…ë¡œë“œ ê°€ëŠ¥)
- GRACE: 11-01 ~ 11-07 (7ì¼ê°„ í—ˆìš©)
- EXPIRE: 11-08 ì´í›„ (ì œì™¸)
```

**ê¶Œì¥ì‚¬í•­:** âœ… **ì±„íƒ ê°•ë ¥ ê¶Œì¥** (ì‹¤ë¬´ì— ë§¤ìš° ìœ ìš©)

---

### 4. íƒ€ì…ë³„ ì„¤ì • â­â­â­â­

**ì¥ì :**
- âœ… **ìœ ì—°ì„±**: ì‹œì¦Œ íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ ì •ì±… ì ìš© ê°€ëŠ¥
- âœ… **í™•ì¥ì„±**: ìƒˆë¡œìš´ ì‹œì¦Œ íƒ€ì… ì¶”ê°€ ìš©ì´

**ì˜ˆì‹œ:**
```json
{
  "types": {
    "holiday": {
      "prep_days": 30,
      "grace_days": 7,
      "score_min": 1
    },
    "seasonal": {
      "prep_days": 60,
      "grace_days": 14,
      "score_min": 2
    }
  },
  "seasons": [
    {
      "id": "halloween",
      "type": "holiday",
      "prep_days": 30,  // íƒ€ì… ê¸°ë³¸ê°’ ì‚¬ìš©
      "grace_days": 7,  // íƒ€ì… ê¸°ë³¸ê°’ ì‚¬ìš©
      "priority": 1
    }
  ]
}
```

**ì£¼ì˜ì‚¬í•­:**
- âš ï¸ **ë³µì¡ë„ ì¦ê°€**: íƒ€ì… ì‹œìŠ¤í…œì´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŒ
- âš ï¸ **ì´ˆê¸° ë‹¨ìˆœí™”**: ì²˜ìŒì—ëŠ” íƒ€ì… ì—†ì´ ì‹œì‘í•˜ê³  í•„ìš”ì‹œ ì¶”ê°€ ê°€ëŠ¥

**ê¶Œì¥ì‚¬í•­:** âš ï¸ **ì„ íƒì  ì±„íƒ** (ì´ˆê¸°ì—ëŠ” ë‹¨ìˆœí™”, í•„ìš”ì‹œ í™•ì¥)

---

### 5. ì‚­ì œ í›„ë³´ ê¸°ëŠ¥ â­â­â­

**ì¥ì :**
- âœ… **ìš´ì˜ íš¨ìœ¨**: ì´ë¯¸ ì—…ë¡œë“œëœ ë§Œë£Œ ìƒí’ˆ ìë™ ì°¾ê¸°
- âœ… **ë§ˆì¼“ ì •ë¦¬**: ì‹œì¦Œì´ ì§€ë‚œ ìƒí’ˆ ì •ë¦¬ ìš©ì´

**ì£¼ì˜ì‚¬í•­:**
- âš ï¸ **ì£¼ì˜ í•„ìš”**: ìë™ ì‚­ì œëŠ” ìœ„í—˜í•˜ë¯€ë¡œ "í›„ë³´"ë¡œë§Œ ì œì‹œ
- âš ï¸ **ìˆ˜ë™ í™•ì¸**: ì‚­ì œ í›„ë³´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ê³  ìˆ˜ë™ìœ¼ë¡œ í™•ì¸ í›„ ì‚­ì œ ê¶Œì¥

**ê¶Œì¥ì‚¬í•­:** âš ï¸ **ì„ íƒì  ì±„íƒ** (ì´ˆê¸°ì—ëŠ” ì œì™¸, ì¶”í›„ ì¶”ê°€ ê°€ëŠ¥)

---

## ğŸ”„ ê¸°ì¡´ ì„¤ê³„ì•ˆ vs ê°œì„ ì•ˆ ë¹„êµ

| í•­ëª© | ê¸°ì¡´ ì„¤ê³„ì•ˆ | ê°œì„ ì•ˆ | í‰ê°€ |
|------|------------|--------|------|
| **ì„¤ì • ê´€ë¦¬** | JSON ì§ì ‘ í¸ì§‘ | Excel í¸ì§‘ â†’ JSON ìë™ ì»´íŒŒì¼ | âœ… ê°œì„ ì•ˆ ìš°ìˆ˜ |
| **ìºì‹œ ê°±ì‹ ** | ìˆ˜ë™ ì €ì¥ ë²„íŠ¼ í•„ìš” | mtime ê¸°ë°˜ ìë™ ê°±ì‹  | âœ… ê°œì„ ì•ˆ ìš°ìˆ˜ |
| **ì‹œì¦Œ ê°ì§€** | í‚¤ì›Œë“œ ë§¤ì¹­ (ë‹¨ìˆœ) | ì ìˆ˜ì œ (include/exclude) | âœ… ê°œì„ ì•ˆ ìš°ìˆ˜ |
| **ìœ íš¨ì„± ê²€ì‚¬** | ACTIVE/GRACE/EXPIRE | PREP/ACTIVE/GRACE/EXPIRE | âœ… ê°œì„ ì•ˆ ìš°ìˆ˜ |
| **íƒ€ì… ì‹œìŠ¤í…œ** | ì—†ìŒ | íƒ€ì…ë³„ ì„¤ì • ê°€ëŠ¥ | âš ï¸ ì„ íƒì  |
| **ì‚­ì œ í›„ë³´** | ì—†ìŒ | ì‚­ì œ í›„ë³´ ì¶”ì¶œ | âš ï¸ ì„ íƒì  |
| **ë³µì¡ë„** | ë‚®ìŒ | ì¤‘ê°„~ë†’ìŒ | âš ï¸ ì£¼ì˜ í•„ìš” |
| **ìš´ì˜ í¸ì˜ì„±** | ì¤‘ê°„ | ë§¤ìš° ë†’ìŒ (ìë™ ìºì‹œ) | âœ… ê°œì„ ì•ˆ ìš°ìˆ˜ |

---

## ğŸ“ ìµœì¢… ê¶Œì¥ì•ˆ (ë‹¨ê³„ì  êµ¬í˜„)

### Phase 1: í•µì‹¬ ê¸°ëŠ¥ (í•„ìˆ˜) âœ…
1. **Excel + JSON ì´ì¤‘ êµ¬ì¡° + ìë™ ìºì‹œ ê°±ì‹ **
   - Excel í¸ì§‘ â†’ JSON ìë™ ì»´íŒŒì¼ (mtime ê¸°ë°˜)
   - "ì„¤ì • ì €ì¥" ë²„íŠ¼ ì—†ì´ë„ ìë™ ë°˜ì˜
   - ê¸°ë³¸ ì‹œì¦Œ ì„¤ì • ê´€ë¦¬

2. **PREP ê¸°ê°„ ì¶”ê°€**
   - 4ë‹¨ê³„ ì‹œìŠ¤í…œ (PREP/ACTIVE/GRACE/EXPIRE)
   - íƒ€ì…ë³„ ê¸°ë³¸ê°’ ì„¤ì • (ì„ íƒì )

3. **ê¸°ë³¸ í•„í„°ë§ ë¡œì§**
   - `get_products_for_upload()`ì— í†µí•©
   - ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ ì „ì— ìˆ˜í–‰
   - `load_season_config()` í•¨ìˆ˜ë¡œ ìë™ ìºì‹œ ë¡œë”©

### Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (ì„ íƒ) âš ï¸
4. **ì ìˆ˜ì œ ì‹œì¦Œ ê°ì§€**
   - include/exclude í‚¤ì›Œë“œ ë¶„ë¦¬
   - score ê³„ì‚° ë° score_min ì„ê³„ê°’

5. **íƒ€ì…ë³„ ì„¤ì •**
   - TYPE_PRESETS ì‹œíŠ¸ ì¶”ê°€
   - íƒ€ì…ë³„ prep_days/grace_days/score_min

### Phase 3: í™•ì¥ ê¸°ëŠ¥ (ì¶”í›„) ğŸ”®
6. **ì‚­ì œ í›„ë³´ ê¸°ëŠ¥**
   - ì´ë¯¸ ì—…ë¡œë“œëœ ë§Œë£Œ ìƒí’ˆ ì°¾ê¸°
   - ì‚­ì œ í›„ë³´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ê°œì„  ì œì•ˆ

### 1. ì ìˆ˜ì œì˜ ë³µì¡ë„
**ë¬¸ì œ:** ì ìˆ˜ ê³„ì‚° ë¡œì§ì´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŒ

**ì œì•ˆ:**
- ì´ˆê¸°ì—ëŠ” ë‹¨ìˆœí™”: include ë§¤ì¹­ = +1ì , exclude ë§¤ì¹­ = ì¦‰ì‹œ ì œì™¸
- ì¶”í›„ ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ ì¶”ê°€ ê°€ëŠ¥

### 2. Excel â†’ JSON ì»´íŒŒì¼ ê²€ì¦ ë° ìë™ ìºì‹œ
**ë¬¸ì œ:** Excel í¸ì§‘ ì‹œ ì˜¤ë¥˜ê°€ JSONì— ë°˜ì˜ë  ìˆ˜ ìˆìŒ

**ì œì•ˆ:**
- ì»´íŒŒì¼ ì‹œ ë°ì´í„° ê²€ì¦ ë¡œì§ í•„ìˆ˜
- í•„ìˆ˜ í•„ë“œ ëˆ„ë½, ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜ ë“± ì²´í¬
- ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ Excel ìœ„ì¹˜ í‘œì‹œ
- **ìë™ ìºì‹œ ê°±ì‹ **: mtime ê¸°ë°˜ìœ¼ë¡œ Excel ë³€ê²½ ê°ì§€ ì‹œ ìë™ ì¬ìƒì„±
- Excel íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì •ì±… ê²°ì •: ì´ì „ JSON ìºì‹œ ì‚¬ìš© vs ê°•ì œ ì¤‘ë‹¨

### 3. íƒ€ì… ì‹œìŠ¤í…œì˜ í•„ìš”ì„±
**ë¬¸ì œ:** ì´ˆê¸°ì—ëŠ” íƒ€ì…ì´ ì—†ì–´ë„ ì¶©ë¶„í•  ìˆ˜ ìˆìŒ

**ì œì•ˆ:**
- Phase 1ì—ì„œëŠ” íƒ€ì… ì—†ì´ ì‹œì‘
- ì‹œì¦Œë³„ë¡œ ê°œë³„ prep_days/grace_days ì„¤ì •
- ì¶”í›„ íƒ€ì… ì‹œìŠ¤í…œì´ í•„ìš”í•´ì§€ë©´ ì¶”ê°€

### 4. ì‚­ì œ í›„ë³´ ê¸°ëŠ¥ì˜ ìœ„í—˜ì„±
**ë¬¸ì œ:** ìë™ ì‚­ì œëŠ” ìœ„í—˜í•  ìˆ˜ ìˆìŒ

**ì œì•ˆ:**
- "ì‚­ì œ í›„ë³´" ë¦¬ìŠ¤íŠ¸ë§Œ ì œê³µ
- ì‹¤ì œ ì‚­ì œëŠ” ìˆ˜ë™ìœ¼ë¡œ í™•ì¸ í›„ ìˆ˜í–‰
- ì‚­ì œ ì´ë ¥ ê¸°ë¡

---

## ğŸ¯ ìµœì¢… ê²°ë¡ 

### âœ… ì±„íƒ ê¶Œì¥ ì‚¬í•­
1. **Excel + JSON ì´ì¤‘ êµ¬ì¡° + ìë™ ìºì‹œ ê°±ì‹ ** - ì‚¬ìš©ì„±ê³¼ ì„±ëŠ¥ ëª¨ë‘ ìš°ìˆ˜, ìš´ì˜ ë‚œì´ë„ ìµœì†Œ
2. **PREP ê¸°ê°„ ì¶”ê°€** - ì‹¤ë¬´ì— ë§¤ìš° ìœ ìš©
3. **4ë‹¨ê³„ ì‹œìŠ¤í…œ** - í˜„ì‹¤ì ì¸ í•„í„°ë§
4. **ìë™ ìºì‹œ ë¡œë”© (mtime ê¸°ë°˜)** - "ì„¤ì • ì €ì¥" ë²„íŠ¼ ë¶ˆí•„ìš”, ìë™ ë°˜ì˜

### âš ï¸ ì„ íƒì  ì±„íƒ ì‚¬í•­
5. **ì ìˆ˜ì œ ì‹œì¦Œ ê°ì§€** - ì •í™•ë„ í–¥ìƒì´ì§€ë§Œ ë³µì¡ë„ ì¦ê°€
6. **íƒ€ì…ë³„ ì„¤ì •** - í•„ìš”ì‹œ ì¶”ê°€ ê°€ëŠ¥
7. **ì‚­ì œ í›„ë³´ ê¸°ëŠ¥** - ì¶”í›„ ì¶”ê°€ ê°€ëŠ¥

### ğŸ“Œ êµ¬í˜„ ìš°ì„ ìˆœìœ„
1. **1ìˆœìœ„**: Excel + JSON êµ¬ì¡° + ìë™ ìºì‹œ, PREP ê¸°ê°„, ê¸°ë³¸ í•„í„°ë§
2. **2ìˆœìœ„**: ì ìˆ˜ì œ ê°ì§€ (ë‹¨ìˆœí™” ë²„ì „)
3. **3ìˆœìœ„**: íƒ€ì… ì‹œìŠ¤í…œ, ì‚­ì œ í›„ë³´ ê¸°ëŠ¥

---

## ğŸ’¡ ì¶”ê°€ ì œì•ˆ

### Excel ì‹œíŠ¸ êµ¬ì¡° ì˜ˆì‹œ
```
Season_TYPE_Keyword.xlsx

[TYPE_PRESETS]
íƒ€ì…ID | íƒ€ì…ëª… | prep_days | grace_days | score_min
holiday | ê³µíœ´ì¼ | 30 | 7 | 1
seasonal | ê³„ì ˆ | 60 | 14 | 2

[SEASON_MASTER]
ì‹œì¦ŒID | ì‹œì¦Œëª… | íƒ€ì…ID | ì‹œì‘ì¼ | ì¢…ë£Œì¼ | cross_year | prep_override | grace_override | priority
halloween | í• ë¡œìœˆ | holiday | 10-01 | 10-31 | FALSE | | | 1
winter | ê²¨ìš¸ | seasonal | 12-01 | 02-28 | TRUE | | | 2

[KEYWORDS]
ì‹œì¦ŒID | í‚¤ì›Œë“œ | polarity | ê°€ì¤‘ì¹˜
halloween | í• ë¡œìœˆ | include | 1
halloween | í˜¸ë°• | include | 1
halloween | ì¼ë°˜ìš© | exclude | 0
```

### JSON ì»´íŒŒì¼ ê²°ê³¼ ì˜ˆì‹œ
```json
{
  "version": "2.0",
  "settings": {
    "filter_mode": "exclude_expired",
    "case_sensitive": false
  },
  "types": {
    "holiday": {
      "prep_days": 30,
      "grace_days": 7,
      "score_min": 1
    }
  },
  "seasons": [
    {
      "id": "halloween",
      "name": "í• ë¡œìœˆ",
      "type": "holiday",
      "start_date": "10-01",
      "end_date": "10-31",
      "cross_year": false,
      "prep_days": 30,
      "grace_days": 7,
      "priority": 1,
      "keywords": {
        "include": [
          {"keyword": "í• ë¡œìœˆ", "weight": 1},
          {"keyword": "í˜¸ë°•", "weight": 1}
        ],
        "exclude": [
          {"keyword": "ì¼ë°˜ìš©", "weight": 0}
        ]
      }
    }
  ]
}
```

---

## âœ… ìµœì¢… í‰ê°€

**ì¢…í•© í‰ê°€: â­â­â­â­â­ (5/5)** â¬†ï¸ (ìë™ ìºì‹œ ì¶”ê°€ë¡œ ì ìˆ˜ ìƒìŠ¹)

ì œì•ˆëœ ì•„ì´ë””ì–´ëŠ” ê¸°ì¡´ ì„¤ê³„ì•ˆì„ í¬ê²Œ ê°œì„ í•©ë‹ˆë‹¤. íŠ¹íˆ:
- Excel í¸ì§‘ì˜ ì‚¬ìš©ì„± â­â­â­â­â­
- **ìë™ ìºì‹œ ê°±ì‹ ì˜ ìš´ì˜ í¸ì˜ì„±** â­â­â­â­â­ (ì‹ ê·œ)
- PREP ê¸°ê°„ì˜ ì‹¤ë¬´ ë°˜ì˜ë„ â­â­â­â­â­
- ì ìˆ˜ì œì˜ ì •í™•ë„ í–¥ìƒ â­â­â­â­

ë‹¤ë§Œ ì´ˆê¸° êµ¬í˜„ ì‹œ ë³µì¡ë„ë¥¼ ê³ ë ¤í•˜ì—¬ **ë‹¨ê³„ì  êµ¬í˜„**ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

---

## ğŸ”§ êµ¬í˜„ í†µí•© ì˜ˆì‹œ

### `db_handler.py`ì— í†µí•©

```python
# database/db_handler.py

import os
import json
from typing import Dict, List, Optional

class DBHandler:
    # ... ê¸°ì¡´ ì½”ë“œ ...
    
    def _load_season_config(self) -> Optional[Dict]:
        """
        ì‹œì¦Œ ì„¤ì • ë¡œë”© (ìë™ ìºì‹œ ê°±ì‹ )
        
        Returns:
            ì‹œì¦Œ ì„¤ì • ë”•ì…”ë„ˆë¦¬ ë˜ëŠ” None
        """
        excel_path = os.path.join(
            os.path.dirname(os.path.dirname(__file__)),
            "Season_TYPE_Keyword.xlsx"
        )
        json_path = os.path.join(
            os.path.dirname(os.path.dirname(__file__)),
            "season_filters.json"
        )
        
        try:
            from .season_filter_loader import load_season_config
            return load_season_config(excel_path, json_path)
        except Exception as e:
            print(f"[ì‹œì¦Œ í•„í„°] ì„¤ì • ë¡œë”© ì‹¤íŒ¨: {e}")
            return None
    
    def get_products_for_upload(self, category: str, sheet_name: str, 
                                business_number: str, status: str = 'ACTIVE',
                                apply_season_filter: bool = True) -> List[Dict]:
        """
        ì—…ë¡œë“œìš© ìƒí’ˆ ì¡°íšŒ (ì‹œì¦Œ í•„í„°ë§ í¬í•¨)
        
        Args:
            category: ì¹´í…Œê³ ë¦¬ëª…
            sheet_name: ì‹œíŠ¸ëª… (ë§ˆì¼“ íƒ€ì…)
            business_number: ì‚¬ì—…ìë²ˆí˜¸
            status: ìƒí’ˆ ìƒíƒœ
            apply_season_filter: ì‹œì¦Œ í•„í„°ë§ ì ìš© ì—¬ë¶€
        
        Returns:
            í•„í„°ë§ëœ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸
        """
        # 1. ê¸°ë³¸ ìƒí’ˆ ì¡°íšŒ (ê¸°ì¡´ ë¡œì§)
        products = self._get_products_base(category, status)
        
        # 2. ì‹œì¦Œ í•„í„°ë§ ì ìš© (ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ ì „ì— ìˆ˜í–‰)
        if apply_season_filter:
            season_config = self._load_season_config()
            if season_config:
                from .season_filter import filter_products_by_season
                products, excluded_count, excluded_seasons = filter_products_by_season(
                    products, season_config
                )
                # ë¡œê·¸ ê¸°ë¡
                if excluded_count > 0:
                    print(f"[ì‹œì¦Œ í•„í„°] {excluded_count}ê°œ ìƒí’ˆ ì œì™¸ë¨: {excluded_seasons}")
        
        # 3. ë§ˆì¼“ë³„ ì¶œë ¥ì œí•œ ê¸°ë¡ í™•ì¸ (ê¸°ì¡´ ë¡œì§)
        # ... (upload_logs í…Œì´ë¸”ì—ì„œ ì´ë¯¸ ì‚¬ìš©í•œ ì¡°í•© ì œì™¸)
        
        return products
```

### `season_filter_loader.py` (ì‹ ê·œ íŒŒì¼)

```python
# database/season_filter_loader.py

import os
import json
import pandas as pd
from typing import Dict, Optional

def load_season_config(excel_path: str, json_path: str) -> Dict:
    """
    ì‹œì¦Œ ì„¤ì • ë¡œë”© (ìë™ ìºì‹œ ê°±ì‹ )
    """
    # 1. Excel íŒŒì¼ ì¡´ì¬ í™•ì¸
    if not os.path.exists(excel_path):
        # Excelì´ ì—†ìœ¼ë©´ JSONë§Œ ì‚¬ìš©
        if os.path.exists(json_path):
            with open(json_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        raise FileNotFoundError(f"Excel íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {excel_path}")
    
    # 2. JSON ìºì‹œ ì¡´ì¬ ë° ìµœì‹ ì„± í™•ì¸
    excel_mtime = os.path.getmtime(excel_path)
    json_exists = os.path.exists(json_path)
    
    if json_exists:
        json_mtime = os.path.getmtime(json_path)
        # JSONì´ ìµœì‹ ì´ë©´ ë°”ë¡œ ë¡œë”©
        if json_mtime >= excel_mtime:
            try:
                with open(json_path, 'r', encoding='utf-8') as f:
                    config = json.load(f)
                print(f"[ì‹œì¦Œ í•„í„°] JSON ìºì‹œ ì‚¬ìš© (ìµœì‹ )")
                return config
            except Exception as e:
                print(f"[ì‹œì¦Œ í•„í„°] JSON ë¡œë”© ì‹¤íŒ¨: {e}, Excelì—ì„œ ì¬ìƒì„±")
    
    # 3. Excelì´ ë” ìµœì‹ ì´ê±°ë‚˜ JSONì´ ì—†ìœ¼ë©´ ì¬ìƒì„±
    print(f"[ì‹œì¦Œ í•„í„°] Excel ë³€ê²½ ê°ì§€ â†’ JSON ì¬ìƒì„±")
    try:
        config = parse_excel_to_config(excel_path)
        
        # JSON ì €ì¥
        os.makedirs(os.path.dirname(json_path), exist_ok=True)
        with open(json_path, 'w', encoding='utf-8') as f:
            json.dump(config, f, ensure_ascii=False, indent=2)
        
        print(f"[ì‹œì¦Œ í•„í„°] JSON ìºì‹œ ìƒì„± ì™„ë£Œ")
        return config
        
    except Exception as e:
        # Excel íŒŒì‹± ì‹¤íŒ¨ ì‹œ
        if json_exists:
            print(f"[ì‹œì¦Œ í•„í„°] âš ï¸ Excel íŒŒì‹± ì‹¤íŒ¨: {e}")
            print(f"[ì‹œì¦Œ í•„í„°] ì´ì „ JSON ìºì‹œ ì‚¬ìš© (ë§ˆì§€ë§‰ ì •ìƒ ì„¤ì •)")
            with open(json_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        else:
            raise Exception(f"Excel íŒŒì‹± ì‹¤íŒ¨ ë° JSON ìºì‹œ ì—†ìŒ: {e}")

def parse_excel_to_config(excel_path: str) -> Dict:
    """
    Excel íŒŒì¼ì„ ì½ì–´ì„œ JSON êµ¬ì¡°ë¡œ ë³€í™˜
    """
    # Excel ì‹œíŠ¸ ì½ê¸°
    df_types = pd.read_excel(excel_path, sheet_name='TYPE_PRESETS')
    df_seasons = pd.read_excel(excel_path, sheet_name='SEASON_MASTER')
    df_keywords = pd.read_excel(excel_path, sheet_name='KEYWORDS')
    
    # JSON êµ¬ì¡°ë¡œ ë³€í™˜ (êµ¬í˜„ ìƒëµ - ìœ„ ì˜ˆì‹œ ì°¸ê³ )
    # ...
    
    return config
```

