# ì‹œì¦Œ í•„í„°ë§ ê°€ê³µ ê¸°ê°„ ê²€í†  ë° ê°œì„ ì•ˆ

## ğŸ“‹ í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### í˜„ì¬ ì½”ë“œ ë¶„ì„

**ìœ„ì¹˜**: `season_filter_manager_gui.py`ì˜ `_check_season_validity()` í•¨ìˆ˜

```python
prep_start = start_date - pd.Timedelta(days=30)  # ì‹œì¦Œ ì‹œì‘ 30ì¼ ì „
active_end = end_date - pd.Timedelta(days=21)    # ì‹œì¦Œ ì¢…ë£Œ 21ì¼ ì „

# í¬í•¨ ê¸°ê°„: prep_start ~ active_end
if prep_start <= current_date <= active_end:
    return "INCLUDE"
else:
    return "EXCLUDE"
```

### í˜„ì¬ ë°©ì‹ì˜ ì˜ë¯¸

1. **ì†Œì‹± ì‹œì‘**: ì‹œì¦Œ ì‹œì‘ 30ì¼ ì „ë¶€í„° ì†Œì‹± ê°€ëŠ¥
2. **ê°€ê³µ ì™„ë£Œ ë§ˆê°**: ì‹œì¦Œ ì¢…ë£Œ 21ì¼ ì „ê¹Œì§€ ê°€ê³µ ì™„ë£Œ í•„ìš”
3. **í¬í•¨ ê¸°ê°„**: `(ì‹œì‘ì¼ - 30ì¼) ~ (ì¢…ë£Œì¼ - 21ì¼)`

**ì˜ˆì‹œ (í• ë¡œìœˆ ì‹œì¦Œ: 10-01 ~ 10-31)**
- ì†Œì‹± ì‹œì‘: 09-01 (30ì¼ ì „)
- ê°€ê³µ ì™„ë£Œ ë§ˆê°: 10-10 (21ì¼ ì „)
- í¬í•¨ ê¸°ê°„: 09-01 ~ 10-10

---

## âœ… í˜„ì¬ ë°©ì‹ì˜ ì¥ì 

1. **ì‹¤ë¬´ ë°˜ì˜**: ì†Œì‹±ê³¼ ê°€ê³µ ê¸°ê°„ì„ ê³ ë ¤í•œ í˜„ì‹¤ì ì¸ ì„¤ê³„
2. **ë‹¨ìˆœí•¨**: 2ê°œì˜ ê¸°ê°„ë§Œìœ¼ë¡œ ëª…í™•í•œ êµ¬ë¶„
3. **ì•ˆì „ ë§ˆì§„**: ì‹œì¦Œ ì¢…ë£Œ ì „ 21ì¼ ì—¬ìœ ë¡œ ê°€ê³µ ì™„ë£Œ ë³´ì¥

---

## âš ï¸ í˜„ì¬ ë°©ì‹ì˜ ë¬¸ì œì  ë° ê°œì„  í•„ìš” ì‚¬í•­

### ë¬¸ì œì  1: í•˜ë“œì½”ë”©ëœ ê¸°ê°„

**í˜„ì¬ ë¬¸ì œ:**
- `30ì¼`, `21ì¼`ì´ í•˜ë“œì½”ë”©ë˜ì–´ ìˆìŒ
- ì‹œì¦Œë³„ë¡œ ë‹¤ë¥¸ ê°€ê³µ ê¸°ê°„ì´ í•„ìš”í•œë° ê³ ì •ê°’ ì‚¬ìš©

**ê°œì„ ì•ˆ:**
- Excel ì„¤ì •ì—ì„œ `prep_days` (ì†Œì‹± ì‹œì‘ ê¸°ê°„), `processing_days` (ê°€ê³µ ì™„ë£Œ ë§ˆê° ê¸°ê°„) ì„¤ì • ê°€ëŠ¥
- ì‹œì¦Œë³„ ë˜ëŠ” íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ ê°’ ì„¤ì • ê°€ëŠ¥

### ë¬¸ì œì  2: ìš©ë„ë³„ êµ¬ë¶„ ë¶€ì¡±

**í˜„ì¬ ë¬¸ì œ:**
- ì†Œì‹± ìš©ë„ì™€ DB í•„í„°ë§ ìš©ë„ê°€ ë™ì¼í•œ ê¸°ê°„ ì‚¬ìš©
- ì†Œì‹±ì€ ë” ì¼ì° ì‹œì‘ ê°€ëŠ¥í•˜ì§€ë§Œ, DB í•„í„°ë§ì€ ì‹œì¦Œ ê¸°ê°„ ë‚´ë§Œ í•„ìš”

**ê°œì„ ì•ˆ:**
- **ì†Œì‹± ìš©ë„**: `(ì‹œì‘ì¼ - prep_days) ~ (ì¢…ë£Œì¼ - processing_days)` - ê°€ê³µ ì™„ë£Œ ë§ˆê° ì „ê¹Œì§€
- **DB í•„í„°ë§ ìš©ë„**: `ì‹œì‘ì¼ ~ ì¢…ë£Œì¼` - ì‹œì¦Œ ê¸°ê°„ ë‚´ë§Œ
- **ì¼ë°˜ ìƒí’ˆ**: ê¸°ê°„ ë¬´ê´€

### ë¬¸ì œì  3: ê¸°ê°„ ëª…ì¹­ì˜ í˜¼ë™

**í˜„ì¬ ë¬¸ì œ:**
- `prep_days`ê°€ ì†Œì‹± ì‹œì‘ ê¸°ê°„ì„ ì˜ë¯¸í•˜ëŠ”ì§€, ê°€ê³µ ê¸°ê°„ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ë¶ˆëª…í™•
- `active_end`ê°€ ì‹œì¦Œ ì¢…ë£Œì¼ì´ ì•„ë‹Œ ê°€ê³µ ì™„ë£Œ ë§ˆê°ì¼ì„ ì˜ë¯¸

**ê°œì„ ì•ˆ:**
- ëª…í™•í•œ ì»¬ëŸ¼ëª… ì‚¬ìš©:
  - `sourcing_start_days`: ì†Œì‹± ì‹œì‘ ê¸°ê°„ (ì‹œì‘ì¼ ê¸°ì¤€ ì „)
  - `processing_end_days`: ê°€ê³µ ì™„ë£Œ ë§ˆê° ê¸°ê°„ (ì¢…ë£Œì¼ ê¸°ì¤€ ì „)

### ë¬¸ì œì  4: 3ê°€ì§€ ìš©ë„ë³„ ê¸°ê°„ êµ¬ë¶„ ë¶€ì¡±

**í˜„ì¬ ë¬¸ì œ:**
- ìš©ë„ë³„ë¡œ ë‹¤ë¥¸ ê¸°ê°„ì´ í•„ìš”í•œë° í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ì²˜ë¦¬

**ê°œì„ ì•ˆ:**
- ìš©ë„ë³„ë¡œ ë³„ë„ í•¨ìˆ˜ ë˜ëŠ” íŒŒë¼ë¯¸í„°ë¡œ êµ¬ë¶„

---

## ğŸ¯ ê°œì„ ì•ˆ

### ê°œì„ ì•ˆ 1: Excel êµ¬ì¡° ê°œì„ 

#### SEASON_MASTER ì‹œíŠ¸ ì»¬ëŸ¼ ì¶”ê°€

| ì»¬ëŸ¼ëª… | ì„¤ëª… | ê¸°ë³¸ê°’ | ì˜ˆì‹œ |
|--------|------|--------|------|
| ì†Œì‹±ì‹œì‘ì¼ìˆ˜ | ì‹œì¦Œ ì‹œì‘ì¼ ê¸°ì¤€ ëª‡ ì¼ ì „ë¶€í„° ì†Œì‹± ì‹œì‘ | 30 | 30ì¼ ì „ |
| ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜ | ì‹œì¦Œ ì¢…ë£Œì¼ ê¸°ì¤€ ëª‡ ì¼ ì „ê¹Œì§€ ê°€ê³µ ì™„ë£Œ | 21 | 21ì¼ ì „ |
| ì†Œì‹±ê¸°ê°„ | ì†Œì‹± ì‹œì‘ì¼ ~ ê°€ê³µ ì™„ë£Œ ë§ˆê°ì¼ (ìë™ ê³„ì‚°) | - | - |

**ì˜ˆì‹œ:**
```
í• ë¡œìœˆ ì‹œì¦Œ (10-01 ~ 10-31)
- ì†Œì‹±ì‹œì‘ì¼ìˆ˜: 30ì¼
- ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜: 21ì¼
- ì†Œì‹± ê¸°ê°„: 09-01 ~ 10-10 (ìë™ ê³„ì‚°)
```

### ê°œì„ ì•ˆ 2: í•¨ìˆ˜ êµ¬ì¡° ê°œì„ 

#### ìš©ë„ë³„ ê¸°ê°„ í™•ì¸ í•¨ìˆ˜

```python
def check_season_period_for_sourcing(season: Dict, current_date: datetime) -> bool:
    """
    ì†Œì‹± ìš©ë„: ì†Œì‹± ê¸°ê°„ ë‚´ì¸ì§€ í™•ì¸
    
    ê¸°ê°„: (ì‹œì‘ì¼ - ì†Œì‹±ì‹œì‘ì¼ìˆ˜) ~ (ì¢…ë£Œì¼ - ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜)
    """
    start_date = parse_date(season["start_date"], current_date.year)
    end_date = parse_date(season["end_date"], current_date.year)
    
    sourcing_start_days = season.get("sourcing_start_days", 30)
    processing_end_days = season.get("processing_end_days", 21)
    
    sourcing_start = start_date - timedelta(days=sourcing_start_days)
    processing_end = end_date - timedelta(days=processing_end_days)
    
    return sourcing_start <= current_date <= processing_end

def check_season_period_for_db_filtering(season: Dict, current_date: datetime) -> bool:
    """
    DB í•„í„°ë§ ìš©ë„: ì‹œì¦Œ ê¸°ê°„ ë‚´ì¸ì§€ í™•ì¸
    
    ê¸°ê°„: ì‹œì‘ì¼ ~ ì¢…ë£Œì¼
    """
    start_date = parse_date(season["start_date"], current_date.year)
    end_date = parse_date(season["end_date"], current_date.year)
    
    # ì—°ë„ ë„˜ê¹€ ì²˜ë¦¬
    if season.get("cross_year", False) and end_date < start_date:
        if current_date.month >= start_date.month:
            end_date = parse_date(season["end_date"], current_date.year + 1)
        else:
            start_date = parse_date(season["start_date"], current_date.year - 1)
    
    return start_date <= current_date <= end_date
```

### ê°œì„ ì•ˆ 3: í•„í„°ë§ í•¨ìˆ˜ ê°œì„ 

```python
def filter_products_by_season(
    products: List[Dict],
    season_config: Dict,
    use_case: str,  # "ì†Œì‹±", "ì¼ë°˜ìƒí’ˆ", "í˜„ì¬ì‹œì¦Œ"
    current_date: Optional[datetime] = None
) -> List[Dict]:
    """
    ìš©ë„ë³„ ì‹œì¦Œ í•„í„°ë§
    
    Args:
        use_case: 
            - "ì†Œì‹±": ì†Œì‹± ê¸°ê°„ ë‚´ ìƒí’ˆ (ê°€ê³µ ì™„ë£Œ ë§ˆê° ì „ê¹Œì§€)
            - "ì¼ë°˜ìƒí’ˆ": ì‹œì¦Œ í‚¤ì›Œë“œ ì—†ëŠ” ìƒí’ˆ
            - "í˜„ì¬ì‹œì¦Œ": ì‹œì¦Œ ê¸°ê°„ ë‚´ ìƒí’ˆ (ì‹œì‘ì¼ ~ ì¢…ë£Œì¼)
    """
    if current_date is None:
        current_date = datetime.now()
    
    filtered_products = []
    
    for product in products:
        product_name = product.get("ì›ë³¸ìƒí’ˆëª…", product.get("ìƒí’ˆëª…", ""))
        
        if use_case == "ì†Œì‹±":
            # ì†Œì‹± ìš©ë„: ì†Œì‹± ê¸°ê°„ ë‚´ + í‚¤ì›Œë“œ ë§¤ì¹­
            for season in season_config["seasons"]:
                if check_season_period_for_sourcing(season, current_date):
                    score, is_excluded, is_allowed = match_keywords(product_name, season)
                    if not is_excluded or is_allowed:
                        if score >= season.get("score_min", 1):
                            filtered_products.append({
                                **product,
                                "matched_season": season["id"]
                            })
                            break
        
        elif use_case == "ì¼ë°˜ìƒí’ˆ":
            # ì¼ë°˜ ìƒí’ˆ: ì‹œì¦Œ í‚¤ì›Œë“œ ì—†ëŠ” ìƒí’ˆ
            has_season_keyword = False
            for season in season_config["seasons"]:
                score, _, _ = match_keywords(product_name, season)
                if score > 0:
                    has_season_keyword = True
                    break
            if not has_season_keyword:
                filtered_products.append(product)
        
        elif use_case == "í˜„ì¬ì‹œì¦Œ":
            # í˜„ì¬ ì‹œì¦Œ: ì‹œì¦Œ ê¸°ê°„ ë‚´ + í‚¤ì›Œë“œ ë§¤ì¹­
            for season in season_config["seasons"]:
                if check_season_period_for_db_filtering(season, current_date):
                    score, is_excluded, is_allowed = match_keywords(product_name, season)
                    if not is_excluded or is_allowed:
                        if score >= season.get("score_min", 1):
                            filtered_products.append({
                                **product,
                                "matched_season": season["id"]
                            })
                            break
    
    return filtered_products
```

---

## ğŸ“ ìˆ˜ì • í•„ìš” ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. Excel êµ¬ì¡° ìˆ˜ì •

- [ ] SEASON_MASTER ì‹œíŠ¸ì— ì»¬ëŸ¼ ì¶”ê°€
  - [ ] `ì†Œì‹±ì‹œì‘ì¼ìˆ˜` (ë˜ëŠ” `sourcing_start_days`)
  - [ ] `ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜` (ë˜ëŠ” `processing_end_days`)
  - [ ] ê¸°ì¡´ `prep_days`ì™€ì˜ í˜¸í™˜ì„± ê³ ë ¤

### 2. JSON êµ¬ì¡° ìˆ˜ì •

- [ ] ì‹œì¦Œ ì„¤ì •ì— í•„ë“œ ì¶”ê°€
  ```json
  {
    "id": "halloween",
    "sourcing_start_days": 30,
    "processing_end_days": 21,
    ...
  }
  ```

### 3. í•¨ìˆ˜ ìˆ˜ì •

- [ ] `_check_season_validity()` í•¨ìˆ˜ ìˆ˜ì •
  - [ ] ìš©ë„ë³„ë¡œ ë‹¤ë¥¸ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
  - [ ] í•˜ë“œì½”ë”©ëœ ê°’ ì œê±°
  - [ ] Excel ì„¤ì •ê°’ ì‚¬ìš©

- [ ] `filter_products_by_season()` í•¨ìˆ˜ ìˆ˜ì •
  - [ ] ìš©ë„ë³„ ê¸°ê°„ í™•ì¸ ë¡œì§ ì¶”ê°€
  - [ ] ì†Œì‹± ìš©ë„ì™€ DB í•„í„°ë§ ìš©ë„ êµ¬ë¶„

### 4. GUI ìˆ˜ì •

- [ ] Excel í¸ì§‘ í™”ë©´ì— ì»¬ëŸ¼ ì¶”ê°€
  - [ ] `ì†Œì‹±ì‹œì‘ì¼ìˆ˜` ì…ë ¥ í•„ë“œ
  - [ ] `ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜` ì…ë ¥ í•„ë“œ

### 5. ë¬¸ì„œ ìˆ˜ì •

- [ ] ì„¤ê³„ ë¬¸ì„œ ì—…ë°ì´íŠ¸
  - [ ] ê°€ê³µ ê¸°ê°„ ì„¤ëª… ì¶”ê°€
  - [ ] ìš©ë„ë³„ ê¸°ê°„ êµ¬ë¶„ ì„¤ëª…

---

## ğŸ’¡ ì¶”ê°€ ì œì•ˆ

### ì œì•ˆ 1: ê°€ê³µ ê¸°ê°„ ì‹œê°í™”

GUIì—ì„œ ê°€ê³µ ê¸°ê°„ì„ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ:

```
í• ë¡œìœˆ ì‹œì¦Œ (10-01 ~ 10-31)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì†Œì‹± ì‹œì‘ â”‚ ê°€ê³µ ì™„ë£Œ ë§ˆê° â”‚ ì‹œì¦Œ ì¢…ë£Œ â”‚
â”‚ 09-01    â”‚ 10-10          â”‚ 10-31     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì œì•ˆ 2: ê°€ê³µ ê¸°ê°„ ê²½ê³ 

- ì†Œì‹± ê¸°ê°„ì´ ì§€ë‚˜ë©´ ê²½ê³  ë©”ì‹œì§€
- ê°€ê³µ ì™„ë£Œ ë§ˆê°ì¼ì´ ì„ë°•í•˜ë©´ ì•Œë¦¼

### ì œì•ˆ 3: ê°€ê³µ ê¸°ê°„ í†µê³„

- ê° ì‹œì¦Œë³„ ì†Œì‹± ê°€ëŠ¥í•œ ë‚¨ì€ ì¼ìˆ˜
- ê°€ê³µ ì™„ë£Œ ë§ˆê°ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜

---

## ğŸ¯ ìµœì¢… ê¶Œì¥ì•ˆ

### ë‹¨ê³„ì  ê°œì„ 

**Phase 1: ê¸°ë³¸ ê°œì„  (í•„ìˆ˜)**
1. Excel êµ¬ì¡°ì— `ì†Œì‹±ì‹œì‘ì¼ìˆ˜`, `ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜` ì»¬ëŸ¼ ì¶”ê°€
2. í•˜ë“œì½”ë”©ëœ ê°’ ì œê±°í•˜ê³  Excel ì„¤ì •ê°’ ì‚¬ìš©
3. ìš©ë„ë³„ í•¨ìˆ˜ ë¶„ë¦¬ (ì†Œì‹± vs DB í•„í„°ë§)

**Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (ì„ íƒ)**
4. GUIì— ê°€ê³µ ê¸°ê°„ ì‹œê°í™”
5. ê°€ê³µ ê¸°ê°„ ê²½ê³  ë° ì•Œë¦¼
6. ê°€ê³µ ê¸°ê°„ í†µê³„

---

## ğŸ“Œ ê²°ë¡ 

í˜„ì¬ ë°©ì‹ì€ **ì‹¤ë¬´ë¥¼ ì˜ ë°˜ì˜**í•˜ê³  ìˆì§€ë§Œ, ë‹¤ìŒ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤:

1. âœ… **í•˜ë“œì½”ë”© ì œê±°**: Excel ì„¤ì •ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥í•˜ê²Œ
2. âœ… **ìš©ë„ë³„ êµ¬ë¶„**: ì†Œì‹±ê³¼ DB í•„í„°ë§ ìš©ë„ ë¶„ë¦¬
3. âœ… **ëª…í™•í•œ ëª…ì¹­**: `ì†Œì‹±ì‹œì‘ì¼ìˆ˜`, `ê°€ê³µì™„ë£Œë§ˆê°ì¼ìˆ˜` ì‚¬ìš©
4. âœ… **ìœ ì—°ì„±**: ì‹œì¦Œë³„ë¡œ ë‹¤ë¥¸ ê°€ê³µ ê¸°ê°„ ì„¤ì • ê°€ëŠ¥

ì´ ê°œì„ ì•ˆì„ ì ìš©í•˜ë©´ ë” ìœ ì—°í•˜ê³  ì‹¤ë¬´ì— ë§ëŠ” ì‹œìŠ¤í…œì´ ë©ë‹ˆë‹¤.

